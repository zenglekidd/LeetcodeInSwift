import Foundation
/*
 424. Longest Repeating Character Replacement
 Medium

 Given a string s that consists of only uppercase English letters, you can perform at most k operations on that string.

 In one operation, you can choose any character of the string and change it to any other uppercase English character.

 Find the length of the longest sub-string containing all repeating letters you can get after performing the above operations.

 Note:
 Both the string's length and k will not exceed 10^4.

 Example 1:
 Input:
 s = "ABAB", k = 2
 Output:
 4
 Explanation:
 Replace the two 'A's with two 'B's or vice versa.
  
 Example 2:
 Input:
 s = "AABABBA", k = 1
 Output:
 4
 Explanation:
 Replace the one 'A' in the middle with 'B' and form "AABBBBA".
 The substring "BBBB" has the longest repeating letters, which is 4.
 */

class Solution {
    func characterReplacement(_ s: String, _ k: Int) -> Int {
        // Total substring length - most repeated character in the string<= k
        // Left points to left window side
        // Right points to right window side
        // Keep move the right window side + 1, check if the last element repeat count is the largest,
        // if so keep it
        
        let s = Array(s)
        let len = s.count
        var repeatCounts: [Character: Int] = [:]
        var left = 0
        var maxCount = 0
        var maxLength = 0
        
        for right in 0 ..< len {
            repeatCounts[s[right]] = (repeatCounts[s[right]] ?? 0) + 1
            maxCount = max(maxCount, repeatCounts[s[right]]!)
            
            while (right - left + 1 - maxCount > k) {
                repeatCounts[s[left]]! -= 1
                left += 1
            }
            maxLength = max(maxLength, right - left + 1)
        }
        
        return maxLength
    }
}

import Foundation
import XCTest
class SolutionTests: XCTestCase {
    var solution: Solution!
    var repeatTimes = 1000
    override func setUp() {
        super.setUp()
        solution = Solution()
    }
    
    func testExample1() {
        let results = solution.characterReplacement("ABAB", 2)
        XCTAssertEqual(results, 4)
    }
    
    func testExample2() {
        let results = solution.characterReplacement("AABABBA", 1)
        XCTAssertEqual(results, 4)
    }

    func testExample3() {
        let results = solution.characterReplacement("CAAFDAEFFAEECBDFDFAECACBDADDEEFFCDEDBDDEDDEAFEFFCCFDDEFBBABAEACCADFEEBAFFBCBDADCCCAFAFBFCCACBDDBDEFECCDDEECBDEFEDCEDEFFACFFCFEFCCBDCBAEDEBBCDBECCFEDEDBDFAEFBCEFEFECBFCBBAFBAFDFCDCEBAFFDFFABCCABDDAEEEFDFCDECEBEEBCCECACEECBCBBEDBBECAAFDEAADCBDAADCDDFBDDCCFACACBBCDFBCBEFDCAFDBACFCEAAFDEBCDCCFFCEFFECECBFABFACCBACAEFEDCECCFBCCBEDECCBAFDDBEDDABDDADEFADDCDABDDBEECDDDCBDDABECCBBFDBBBCDBFCACBBFFBBBDFDDFFCBBEEAEFEDECAFEDACABAEEAAAFEBEBAEFEACEECEFDECBEDCEFDDFCACFCCDCFBBEBAFABECCACDFBBDFEEDABFEFFFDFFDCCFDAFCFEFBBABCBCFABEBBFDABEAEFDAFDDBFAEBCEEADBAFDBDFBAEACEDADCDADDCDEBBAFBBEEBFFDACCAFFFCCFEEADFECAFBEBCDFADCCECFEEBDFBDEBFEFEEAEEADCECBFEDFBCDEADDFFFDCDFAFCAECBBBBDBAFEBBBEEDABCEDECABDCFBEBAFCEFBECDACEFEBFCEDFCDBBCBFCCBCAACEFDBCDFDDEACAFADCAAEFAAEAECFBAFFFEAFFBCDBEFFEFDDECEEACACFEDFFBDEDCCDDEBEBBDDAAFCCAAADCEBEECFADFEECDDAAFCFDADBBCECADDBEEAEEFBEDBBADAFEAFFBDAEFCBCCBABDEFFADEBEBCEBEBDCECEDCFCEECFBAEEDFBAEDAECEDDCFEEEAEABDDDDBCBABABCBEDDABCEFACBCAFBCFBDFFAEAFDFBAAFDFAECCACBFEAAEDBAFADCADFCBAACBFECFFBDDEDCCBFDFFBCAADDAABEECDBDEFEFABABDDABACCADFFECBAEAFCEBFFAEFCDFACAEBFFCFAFBEFBDACECECFCFABFBEEFFADBDEECADEFAFAECBFDCADFFDFDEADFEBFDBBBDAEEBBDBDBFDEDFDCAAEFBADEDABEECABAACAFFACBBDEECDDDDAAACCBADCCBECACCBEEDBABCDEBFBFECDFEFFCDEFBEFDACDEAADBECBBCBCACEFDECFCACDDABDBAFFDCAFDADDEDBDEEEFBCFEACCBDEFCEFECCCEECBDADBCDBBDEFEDEAEDCEFBAAEACBEDBFFFADCDDFEFFBBACEECBBBBCCDDEEAEAEDEBCADFABDEBBFEEAADBCBFACDDACBDDFFFAEECEFBBDABBADDDDCBCFAAEABFFABCFAADDCFDDDDFEDAFFEEEBBBEEACACDECEDECCAFDECDADBDAFCBCAAEAEECCCCBAFABFADFEABFEABFDAADCCECABDCECEAFAEDAFCDDEABCDBCDCCAEBFDDFCBDBDCEEBBDFCCDADEDCADCCCBEBFCEFACDFCFDBDDFBCBDBACFEECCEBECEBEABDCDCDAFAEBECEFBFABCDDBDFFBAFCFDACEFECABDECFECFBCCFFFEEDAABABDECDBABFCDEFBBAACDEFAEABCDDEAECDFFCFFACFBAFFBBAFDFFAAAFCBCAEACEDFDDEBEBABEFCABACECCFAAECAAEBFFBDADEAAFBADDACFEFBCDCDDEBBAADEEEEFBFCEDDFAAEEFEADEECCADBECAABEECBAFECAFAACFEADBDCBDBCDEDABEBBDAFBDBCBCAFFBBDBDDABBBAEFBADDCBADFFEFFBDFEFDCAAEBFCDABFEFBBADFDBACBEDBABBBBDCCDFDDEBFBADBDDFAABCFDEECCFDBCDACDCDBBEEEEDCAECABAAEFEDAACCDFDCDECFCAEADBFFABCBEAABCCDEEDFBABFDBBCCFDFDDCEBFDCDEBCDAEFCBCEDACACEDEADCEEFBBEEBCCAAADCCFDEBFEEDCDEBEFFECEAFDBCBDCBACEFDBEAFBCCCFECFDEEAFCBEDAAFFFAADFBFFBCAAEEDBAEAADFAFDEAEBEBEEBCAEDCACCBDDDDCBBBABDEAAFEFAFFEDBDEEEACFFFAEBABADEACCDEAFCCCEDCCBABEECEFAEACADDDDBEACEBEFDEEDDBAEEEACDBBBFADCAACDDFACFFAFAECFABADFDDCAFEDECDEDCEABDEFFEFBDECDACDCAECCECCCBCEABBFACDBFDFCECCEFCCEEEABFDDBBFBEDBBAEACEEFDBFFFEECFABBAAEBFBCDECCFCFACBEAEFADACCBEDBFBBFAEBFBCBECCAFBBFFEEEBFBCDACBABCCCAEDCEDADCAFADBABFCCAAABFEEBACFFABCFBFABDFABFEFADAEFDCADCDBFCABCAAFDACFEAFCECFBEDAFBFFBFEAFBACDDEFEEBDEBEDDEBBBACCADBFDCEFABDCBFCFECDFDDFAADEDCCEDCEACDEFEAFEEBAFBDEDBADFDEBCBBCEAEFDEFDDAFCDBEBABBABEEAEEDBEFEBBCEEFBAABFBCFEABDFAFEAADDFCEEBECDDBCFACBECECDEFDEBEECEBEFEDADBDABAEEFFEAFEEBDACDCAEBDAEBACFBABFBEADBDBAADAACADCEBCDCEADEEDDAEDFCFBCDBFAEDAFAACEABFADDEEEEDCFCBABAADEAFEBDEAAEFAAFECDEBEDABDBAFBECFCCEFFFFEADFFFDDCAFCBBFBBBEFBACEEDEACEFFEFCEADAACAAFBBAEACCFBCFABBFDDFCEFCDACACFBEBEADEECFEADCBDFDCFCBBDBAFAFCBFAFEFDAFEDBAEDEDABDEECEBECDFBACEDAFEFABFEDEADCAEAFDECCDEEFCECDBFBCDCCCACADFBDEEEFCBABCAFAAACBECDEACEDBBAFBDFDDCEAAADABDCBDADECCCEFFBBDBDFFAFFBEAAABBAFBFFAEAAFEDFDABDBCFFACECCEAFEFCCCBECEBECEDDFCCFECDFCDDAECDCCDDCCFEAABCECFFCBAFBDBABAEDAEFCAFADEBFECECBEEABFECBCDFFCCFECEECAFDFEFCFFBCAEFADADFEFEEFECCFAECCBCADBEACFCCAFFFFCBABDEBBDFDFCBCDCFDBCEBACEEDAEEFCDCFEFEEBBBEBADEEEBBFCEFEACDFEFFAFECBCCDACCDADABBEDBEFCDCADDDCECCEEBADBABCAABBEDBABABDCEFEEADBAFBCDCBBABEBFADEBBACFCBFBCFBBACFEABEDEBCCAEFDAFFAAADCAFDEBEDABCCDCDADFDFFFBBAACFFEDCCFBDBABCBFFDDDAFBCFFBFACECDDCBCDADAEFCEAEBBDABCBDCFCFAEDEBAFFEAFEBBFECDDEDEDCBAFFDFABBDEFEDDAFBFDDEEBADBFFFEDACDAEAAFADDBDCCDBEEABBBEBBCAFAABFFEAABEACFFFAAFEBCAAEEBEFDDBECECEBCEFCABBDBBABECAAFFDBCDCFDAAFCABBEAAFCDAAEECEBCADCDAFDECDBDDBFCBEDEBDDBFFAEDFBAAAADDECBDDBBECFFFFCEACEEEACDBDCDFFBFBEFFABBAFBCACDBFDCBFAAFCBFCAAACBBEFAACAAACFDACADDDCACACBDBAABDEFCCCFAFAFAACDDBDFBFECFEADEEECABAFDECADDDFADBEDBBAFEBFBEBAEAACDECCACACEDCEFECEFFFBBBDFBCBDBCCDDFCABEDFDCEECAAFFBEEDCEBDCEEEBFAEBBFFCFFCDFDDBBBAECBFEBDEEDCEFDDFBDBCDBBEEFFDEFFCBBFDBCFECBECEBDADEEDDBBEADCFCCAABABACBBCAACFEABBFAADDFEFDAFDDFDBBCCBFCBDEEEBAFDEDDCAEBDCDABCACFFDDCEECDEDCCBCAEFCECFDCDCBCDEEACAEAACBADDCFACABFFBCCEACFEFFACDCFDFCDDCBFEEFCFCDFEDACAAFADDAAAAFCBBBABFAACCEEFABAECCECFFFADEBEEDEECCABAAFCECEDFFBACCCEDCCEACAEEBBCBFACBCAEABCEFEABCEBAFBBECEEABDDFEBBFCDDBCBBCEFFEADCBCDCDFBCBABEBAEFEDFEADBEBFFFBAEEADFDDDDFCEECEBDEFFDCBBCDFAFDDFEADEBADACBDAFDDDCCCEDAAFECFFFFDCADEDDFAFBFDEBDBFABEEAFDBFEEDFDECFCBFCDACDDDADECCFDEFADFFCECCDBEDCDCDFFEACDDABFEEDEBFDFADACEEFACEFCECEEAADFBBDEEAEEDDBEECFAFFFDDEBBADBADDFBEBAFDFEAFFCEEEFFACDDECCDFBBBAFFCCAAFEACEAABEDBBAAAEFEAEBFBFCBFFFFADDEEFAEAFFCAACCBDBBAEFACCCCEDDCBBACBEACCDFFBAEAABCFADFFDACCAEFAABCDDFBFCAEAEEDADEDFAFEBDEFAFBDAECAFCCAEBEEFEABEFBEFAFFFFCAACBBDDBDBCCBFDFCDDDAFDCCEBCFECDBFCDEEAFEEACFFCCFFCCAFDCFBEACCEEEECDFFBBAACAEDCEDDCEADEFFFADCBDAEBCFDAFBABCACCCEBEFFEDCBBCDBECCEADAEDEFBFEFEDFDAECEBBFAEBFDBCFECBCBCEFCBCFCDFCDEBBDCFDAEEFCBDCDEACEABCEACBBBBDCBFDCBACABCADBDEEADEFBFADDAAFCFEADCFADBFFAEFAEEAAADBDEEEBFADBACEEEEDDEABAADFCADDFCDFECEFBDFDFDBAAEDBEAFFDCADEDFDDFDEEBACFEFCDCDAFABBABDFFECCDCDCABBBFFBACEEAFBFFFCCCCEBFCDFCBABDBBBDFFFFBECACBEAABADDFEBACDBAFDDCBBBFDACFDECEEDCBAACBEBBFEABEBCCACDEFDCABECFEFACFDEBEFCADDBDABEFFEBBFFCCCDFEDDAECEFDCEAEEBCCCABFBAABAFFBFADAAEEACEBFAADCEEEFDEAACECDDBEDBDDBBEABDEAADEBDBCEABFBEFADCDBECBFFAADFEEEAEDAEAECDCDAFAFBBBEBBBBBEECDDBDBACEACEDEAFDDCEBBEBFDECCFCDFDEDFFDBBDBDFBACADBCECDFBBFFBBDBECAEFADDBDBBFAAFCCCFFAAFEBFCEECBDFACBEDACEEFCEDEFBFCAABEEDCDAEBAEFACEDEEFCADCADEAFABDDBEDEBFEACEDCBCBAFFADAFCBDBBFFFCCFBEFCFEDCFDFFFBEDCDBEDAECCEACCCCEBCAEDDBABCCFBEBBDBCABFAFBAADBDBCEEFBFADBAEACEFBEACCAFADBBDEFFEDADABCCECADAABFDDFFDFDCBDAFFEAEFBBFEBBBDEDDCECAAEFFDCEFCFCCEABCAFAEFADFFBCFDECBABEDCEEEDABCDFDCCBEFBACBAABBADEBFCAEDCCBAFADBEBEFCCDAFBFFDCFFDAFFEABECDBFFBEEFFCEABEBBFFFDDDACCCBBCEABEEBCDDEFCACBDDAFBBFFCECADAABEAABEBDFDEDBBBAECDDAEBCBFFBEBADDDEDDAEFEADBECFDEAEBFEBCAFBFACCBDFDADEADCACEDBAEABFECFCFBFBEFCFCCCFFBAECFEDFBCCBABFDCFCFEFEDDAEEADFCEFDADABBCCCFEACBABDDEAEDBBAEBBEAADFBEDEACBDEFDAFECAFADDDBFCCEAFAEDBFDDDFEEABCDBBAAEBCEDAFBFBBFEACAFEAFDCBCCECAFDDAADDADCAEACBBABEDFBFFCCBACCAEEFFACADEFBDDEDFFDCEABABEFDFCBEDCAEDAAFCCABEACCBBEBDCEEDEACCDCEACCFCDFBAEDADBFCFBBCFDBBEFCDECDDFAEAEBBFBADDFDABBBECEAAFEBBDDDDAACEECEBFBEDEBFDFFEDDACFBABDEFACFFBADCBFDCFCACBFEAECDDFECDAFCACADAACEFBDFDFEFBFDADDADBBCACEEDCAEAFFBCCAFEDEEFFFFEAAEDCAADCDECCCCFCFDABAFDDCACAECCCDBEEACFEBCACBFFABDEBEEAEDBBCFDEBDBACAAAADDDECBBBEDFFDDCCBAECDDBEEECBBCCFFDEBDDCEEEEEEBDFCDBDBFBAADAFACBBBCBAEAEFBFACAEAFFAEEFABDEBFACBBCDABABBECDACABABAEABFCAAADEBBACFBCEBBDCAEEABAACBBCCACFDAFBDCCCEDDDEEECFBDCAECCACFACDFCFBBDBDBCDCBDEEEEEACDDBBDDFACCDCCDABCFDCECFFCEEEECCFFFDCAEACFCDEBAEFACFBAEDAFCEDCFDEDCCDFBFCBBBEEEBDBBBDABDBCCDEBBCCCAFCFFCDCCCBEACBEBABFCFEEFDFCECBBFCDADECBFAFAFCABCBECDAAFEEFDDECBBDBFBABFEDAADCBBAEEACEACABFACEECAAFEEBABBDABFAEBCDEDCACCDCBAFFEDCEAEDBEBBEEDBFCDDEFAECFEDFFBDFDDCECAFCACBDEEBFFFFABEABEACEACFFEBEDFBBDBEABFDDDEDEDFABEEEDBECBBCDAFBDADEFDCBBBBBAAABEFDEDAECDCCACAECFBAEBDCEBEAAECDBDCDEEDCFECADCABDCCBCECDCDEBACCBFFBFBBECFEFCEFFDEFFEDFEBBAABFCCFDEBBADAFFAECEDAAEEBEACEDDECFDEAFBFACAEAAAABCDCBABFABDCBFAFBBFAADCAEEECFBFECBAEADEAAFBEDECBFEECCCEEBFAFDFBFCCEBFEFAFECDCDABEAFEADBCEFBEDAEAFBBBBFAFCFAECCBBECBCFEAECEACACCADEFFDCFEDADDBDEEEDDCBCECBEAFBCCFDCBBEFFDEACDCBCFCEFABEADACEEBAEECCDDFAFFEACAEEADEAFAFDAADCABDFDBCAEEADBFBADEFEAEEFDDFAFEAEBECFDCEEBBACAAFDEEFCCEECEDADEABCAAADEACCFADCEFBCEDEEEFEEDDEDBFABBBCCBCCBBECAFFEBEAFEEBEDBAFADCCDFBBEEECFABCFEBACBFDDFCBFCADBDECBEABACEDFBDDABFDFDAABCECDCCBCACEFEEAEAFDEACBCACEDCAFCEAEECFBAEDCCBACBFACBEADADFCFEBCBDBBAAFFDFBCEECCDECFDBAFABCDAADABECCDFEBDEBBCFCCDEFECADDEFFBDAEEDCFABCACFFBFFDCDDBCDADDCBBBDADBCCDCFDABEEDACEFEBEADBBDCAFDEFFCFACCFAFAEAECDDFEBFFAECCACFBCFDDDDFCCDBFAEAFBCDBFFAFADCBCAEFACFEABACFFACFCCADDCCCEEDCEFECEEEEFECAFFDABAAEFBFFECEDEFFEFEFCBBCBEBAEFCCEAAABBADDFDAABFFAAEBCBBDADFBCECBABFFECEEFDECBCECEBADBADEFBDCCDDAECFECFFACEFDAEBFEFEECAEBFDFABEDADAABCECCAFDEDFBAEFFCDDAFFEDBEEAEFFDFDFEEBCCDDAAADAFFFADABCFFCCCEDAEDEAEFFCEBDFBBCBDFBFAAEEDEABBCFADEFBAAFBBBDBDBCFAEBCAAFCBEDEFFEEEBAAADBABCCEBFACEEFFBFBAFBFBCDBFDACDFABBCFCFDABCBCEAAEDCEBABCFBDADABAFDADAEFDEBAFBABFBBFEBACEADFEACAACAAFACDEDFCAABBFDCDADECDDEADDAFDACABDACDACEFBCBFDADAACDFDFCCDFBBDFEFFCDACFBAAAFCADBADCECDFFABCFACEBDADFABCDCDFFABACCBCEFCAEFFDEDCDFAEDFBCBDFAFFCDDCCDEABFAFFDDAAAEAFABAEFCABEFFAFFEBBEEDEECEDBFDAEBFCFBAEDEFDAADFFDCBEBFBBFFAFFBECBDCCFCDCCFCBBFFBFADACABDCFCDDAECCBBAEEEEEADBFADFACFEEBDFDFCBCDCDBBFECFCFAEBDCDAFEFBFDBCDBDFCADFEBCBDCFDDFFFFAACDACFEBECAAACCDFDCDAEEEFCCCBCCFECEACACEEBDEBFFEFEFECBFAECDAEDDACEDCBBBFDDBDFDEBFEDCFBFEAFAEFADBBCBAFCCBFDDFAADFFEDDBDACBCFEAFDDACCDFFCCFFDEEDBDEFCABCAFECDBCEBCADCBEFCEBABCFBECCCEBCDCBABFBEDCABEFECCEBFBECBCAABFADDEEACCEAADDBCEAFEDABCDDFBACFEDFCEAFFDCAAEDABEFEAAECECBDACEFCBBBFDACDCCDECCCFABABFDCBFBECCACDAAFDFDDEDEFCABABAACABECDCFAEDFFDBDECCCCBFDEBFECEFDFCCEEDECEEBDEDCBCABACBBEAFCDADFAFFCADDDDDDDEEFEBAAFEEFEDADABFACABDACCDBEBEDDFDFBECEFECDAECBAEECFFACEFAFFDCCBEDEBABEEADCBBCBCFDCCADBAADFCDEBFEFFCBDACECDFEABBBDEBADAEBFEDBABEFCDCBFCAFCCAEAEDDDCBEBDCDAEFCBBAEFEEFDAACEACAACBEEFAFDEBDCCBAAEFFCAEFDFBAFFDBCAEAFCCDADEAADCAADAFCDAADAFFCAEFBDDEADAEDEBACDAEDFDFEDCEDFBBEAFCDDEFDCEDFCFCDFEEECDCCBBEBBBFFBAEBFEEBDDFDEDFBFCABFDFFCBDEBADEFAFADCDBAABAEEFFBDEDBCBEDFBBBEAEBEDEDAADDBBFFDFFDDEBFBBDBFFBFCDADFBAACCDABBCADBEAAAECEEDAEBFBDADEBAADFCDBAEBBFCCCFDBACAAAEFCCDACFFFFDAADBEAABACABEBCAEEAAACFCAFDBFDBFCDCEDBBFEDECEBCBACEFFAEEDFECAABDBFEABAEDCBDFBFBAFCEADEEDDDEFEDEEFFBCAEDDDDDFADABABAFFEECADEBFCBEDBDCEDDDECDBEAFCEBCBEEBBEFBDBEDEEDCABDEDBEBAAEFDFFEBADABCCABBABCBDFFCFACCCEEDACEBFAAAFBEAFFEBECACFBAFCDAFAFFADECFACAEFEEDDBBFEBBCFBFACBCDEDBABECBEBFEEBBBBCEFEACDFECAFCEADEFABEBEFEEDDEDFDFDEEDFDFCFEFBEECDCDFFDCFBFCFFEACCFCDEBAFCBAEDFDECEBEEAFEECFDBBBEAABDEDDACDACCBCCAEFAFFBCDDEAEABBEECBCBAADFFBBCCFFCFBDADEBACEECECFBEDBEBBDBCEBDCFDABBDBDECBDCADECDBAFCADBDDAEBEADEEFEAABABACCADEEBBBAAFEBBCADCBEAFACDDFAADBAFDBCFFAACFFDCFCCFCACDFDCFCEBCDBAEEACEFEFFBEBBFFFCFAEDFDEFCDDAFCFEEBEEAFDCBCAACBFECBFBCDDBCFACDDEBE", 3371)
        XCTAssertEqual(results, 4103)
    }
}

SolutionTests.defaultTestSuite.run()
